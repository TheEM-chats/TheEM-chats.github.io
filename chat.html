<!DOCTYPE html>
<html lang="ru">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    html,
    body {
        overflow: hidden;
        /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª —É –æ–∫–Ω–∞ */
        height: 100%;
    }
    
    #myContainer {
        overflow-y: scroll;
        height: 300px;
    }
    
    #myContainer::-webkit-scrollbar {
        width: 4px;
    }
    
    #myContainer::-webkit-scrollbar-track {
        background: transparent;
    }
    
    #myContainer::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
    }
</style>

<head>
    <meta charset="UTF-8" />
    <title>TheEM - —á–∞—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É p5.js –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ p5.dom -->

    <script src="libs/p5.js"></script>
    <script src="libs/xlibs.js"></script>
    <script src="chat/render.js"></script>
    <script src="chat/menu.js"></script>
    <script src="homepage/load_chats.js"></script>
    <script src="chat/usrader.js"></script>
    <script src="chat/usrlist.js"></script>

</head>

<body>
    <script>
        let inputBIG = false

        var ss = getCookie("ss")
        var pp = getCookie("pp");
        let ps = getCookie("ps")
        let target = getCookie("target")
        let name = getCookie("name")
        var chatid = getCookie("chatid")
        let globalres = ""
        let history = []
        let objs = []
        let adds = []
        let subut
        let container
        let btnCancel
        let btnDelete
        let btnEdit
        let btnOpen
        let btnText
        let msgs = 1
        let timer1 = 1
        let lastmsg
        let editmenu = 0
        let joiningcall

        var level
        let displaylevel
        var andpass = "&pass=" + ps
        var targ2 = target


        let autors = new Map();
        var bans = []
        var ids = []
        let passSec = false

        var syssent;


        function getAutor(autid) {
            if (autors.get(autid) != autors.get("id375nonononono")) {
                console.log("–£–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!")
                return autors.get(autid)
            } else {
                console.log("–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ")
                autors.set(autid, "–ó–∞–≥—Ä—É–∑–∫–∞...")
                fetch("https://sebain.pythonanywhere.com/saveget?filename=" + autid + "_profn")
                    .then(response => response.text())
                    .then(data => {
                        if (autors.get(autid) == autors.get("id375nonononono") || autors.get(autid) == "–ó–∞–≥—Ä—É–∑–∫–∞...") {
                            ids.push(autid)
                            console.log(ids)
                        }
                        autors.set(autid, data)
                        render()
                    })
                    .catch(error => {
                        autors.set(autid, "?")
                    });
                return "–ó–∞–≥—Ä—É–∑–∫–∞..."
            }
        }

        function setup() {
            BackStyling()
                //–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è 3 - –ì–ª –ê–¥–º–∏–Ω | 2 - –ú–æ–¥–µ—Ä | 1 - –£—á–∞—Å–Ω–∏–∫ | 0 - –≠—Ç–æ –æ–±—ã—á–Ω—ã–π —á–∞—Ç
            statusButton = createButton("–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
            ButtonStyling(statusButton)
            statusButton.style('border-radius', '7px')
            statusButton.position(0, 38)
            statusButton.size(window.innerWidth - 80, 20)
            statusButton.mousePressed(() => {
                if (level != 0) {
                    console.log("–ù–∞–∂–∞—Ç–æ");
                    listrender();
                }

            });

            function passSec_func() {
                if (!passSec) {
                    passSec = true
                    fetch("https://sebain.pythonanywhere.com/updatepass?filename=chat_" + chatid + "&2pass=" + pp + "&new2pass=" + ps)
                        .then(response => response.text())
                        .then(data => {
                            fetch("https://sebain.pythonanywhere.com/updatepass?filename=" + chatid + "_ignore&2pass=" + pp + "&new2pass=" + ps)
                                .then(response => response.text())
                                .then(data => {
                                    console.log("–ü–∞—Ä–æ–ª–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å!")
                                })
                                .catch(error => {
                                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                                });
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        });

                }
            }

            function reloadStatus() {
                if (target == "channel" || target == "group") {
                    fetch("https://sebain.pythonanywhere.com/get?filename=" + chatid + "_owner")
                        .then(response => response.text())
                        .then(data => {
                            let arr = JSON.parse(data)
                            if (arr[0] == pp) {
                                //–ù–∞—à —É—Ä–æ–≤–µ–Ω—å 3
                                level = 3
                                if (target == "channel") {
                                    displaylevel = "[–ö–ê–ù–ê–õ] [–ì–õ –ê–î–ú–ò–ù]"
                                    statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                } else {
                                    displaylevel = "[–ì–†–£–ü–ü–ê] [–ì–õ –ê–î–ú–ò–ù]"
                                    statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                }
                            } else {
                                num = arr.length - 1
                                let found = false
                                while (num > -1) {
                                    if (arr[num] == pp) {
                                        //–ù–∞—à —É—Ä–æ–≤–µ–Ω—å 2
                                        found = true
                                        level = 2
                                        passSec_func()
                                        if (target == "channel") {
                                            displaylevel = "[–ö–ê–ù–ê–õ] [–ú–û–î–ï–†]"
                                            statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                        } else {
                                            displaylevel = "[–ì–†–£–ü–ü–ê] [–ú–û–î–ï–†]"
                                            statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                        }
                                    }
                                    num--
                                }
                                if (!found) {
                                    //–ù–∞—à —É—Ä–æ–≤–µ–Ω—å 1
                                    level = 1
                                    if (target == "channel") {
                                        displaylevel = "[–ö–ê–ù–ê–õ] [–£–ß–ê–°–ù–ò–ö]"
                                        statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                    } else {
                                        displaylevel = "[–ì–†–£–ü–ü–ê] [–£–ß–ê–°–ù–ò–ö]"
                                        statusButton.html(displaylevel + " {[–¢–´–ö –î–õ–Ø –ë–û–õ–¨–®–ï–ì–û]}")
                                    }
                                }
                            }
                            updatebanlist()


                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        });
                } else {
                    //–ù–∞—à —É—Ä–æ–≤–µ–Ω—å
                    level = 0
                    displaylevel = "[–ß–ê–¢] [–ù–ï–¢ –ê–î–ú–ò–ù–û–í]"
                    statusButton.html(displaylevel)
                    updatebanlist()
                }
            }
            reloadStatus()

            overlay = createButton("")
            overlay.position(0, 0);
            overlay.size(windowWidth, windowHeight);
            overlay.style('background', 'rgba(0, 0, 0, 0.6)');
            overlay.style('position', 'fixed');
            overlay.style('z-index', '5');
            overlay.style('pointer-events', 'auto');
            overlay.mousePressed(() => {
                console.log("–ù–∞ –æ–≤–µ—Ä–ª–µ–π —Ç—ã–∫–∞—Ç—å –Ω–∏–∑—è!")
            });
            if (getCookie("IsReg") != "1" || getCookie("name") == getCookie("—ã–≤–∞—ã–≤–∞—ã–≤–∞—É—Ü–∫—Ü—É–∫–≤–ø—ã–øewwerwr") || getCookie("name") == "undefined") {
                window.location.href = "homepage.html";
            }


            overlay.hide()
            setInterval(() => {
                timer1++
                if (timer1 == 16) {
                    timer1 = 1
                    msgs = 0
                }
                if (msgs > 7) {
                    alert("–ù–ï –û–¢–ü–†–ê–í–õ–Ø–ô–¢–ï –ú–ù–û–ì–û –°–û–û–ë–©–ï–ù–ò–ô, –ò–ù–ê–ß–ï –ë–£–î–ï–¢ –°–õ–û–ñ–ù–ê–Ø –ö–ê–ü–¢–ß–ê")
                }
                if (msgs > 10) {
                    setCookie2("captcha", "yes")
                    window.location.href = "captcha.html"
                }
                console.log(timer1)
                console.log(msgs)

            }, 1000);
            //–û—Ç–ø—Ä–∞–≤–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π - –∫–∞—Ä—Ç–∏–Ω–∫–∞
            function fileToBase64(file, callback) {
                const reader = new FileReader();
                reader.onload = function() {
                    callback(reader.result);
                };
                reader.onerror = function() {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                };
                reader.readAsDataURL(file);
            }

            function compressImage(file, maxSizeBytes, callback) {
                const img = new Image();
                const url = URL.createObjectURL(file);

                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    let quality = 0.95;

                    function tryCompress() {
                        const dataUrl = canvas.toDataURL('image/jpeg', quality);
                        const byteLength = atob(dataUrl.split(',')[1]).length;

                        if (byteLength <= maxSizeBytes || quality < 0.1) {
                            fetch(dataUrl)
                                .then(res => res.blob())
                                .then(blob => {
                                    const newFile = new File([blob], file.name, {
                                        type: 'image/jpeg'
                                    });
                                    callback(newFile);
                                });
                        } else {
                            quality -= 0.05;
                            tryCompress();
                        }
                    }

                    tryCompress();
                };

                img.onerror = function() {
                    callback(null);
                };

                img.src = url;
            }

            function imgsent(file) {
                const MAX_SIZE_MB = 30;
                const MAX_SIZE_BYTES = MAX_SIZE_MB * 1024 * 1024;

                if (!file.type.startsWith('image/')) {
                    console.error('–§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º');
                    return;
                }

                compressImage(file, MAX_SIZE_BYTES, function(compressedFile) {
                    if (!compressedFile) {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ 30 –ú–ë');
                        alert("–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª, –Ω–µ –±–æ–ª—å—à–µ 30 –º–±!")
                        return;
                    }

                    fileToBase64(compressedFile, function(base64) {
                        const apiKey = 'c77c07592cd1f730aacfb02824de3a17'; // ‚Üê –í—Å—Ç–∞–≤—å —Å–≤–æ–π API –∫–ª—é—á —Å imgbb
                        const formData = new FormData();
                        formData.append('image', base64.split(',')[1]);

                        const xhr = new XMLHttpRequest();
                        xhr.open('POST', 'https://api.imgbb.com/1/upload?key=' + apiKey, true);

                        xhr.onload = function() {
                            if (xhr.status === 200) {
                                const result = JSON.parse(xhr.responseText);
                                if (result.success) {
                                    const url = result.data.url;
                                    console.log('–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:', url);
                                    history.push({
                                        type: 'img',
                                        value: url,
                                        sender: pp,
                                        time: Math.floor(Date.now() / 1000),
                                        uid: getRandomFromRange(111111, 999999)
                                    });
                                    push()
                                } else {
                                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', result);
                                }
                            } else {
                                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', xhr.statusText);
                            }
                        };

                        xhr.onerror = function() {
                            console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                        };

                        xhr.send(formData);
                    });
                });
            }

            function filesent(file, zagolov) {
                const formData = new FormData();
                formData.append('file', file);

                // üéöÔ∏è –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä + –ø—Ä–æ—Ü–µ–Ω—Ç—ã
                const overlay = createDiv();
                overlay.style(`
                  position: fixed;
                  top: 0; left: 0;
                  width: 100vw; height: 100vh;
                  background: rgba(0,0,0,0.6);
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                  z-index: 1000;
                `);
                overlay.parent(document.body);

                const progressBar = createElement('progress', '0');
                progressBar.attribute('max', '100');
                progressBar.style('width: 400px; height: 30px;');
                progressBar.parent(overlay);

                const percentText = createP('0%');
                percentText.style('color: white; font-size: 24px; margin-top: 10px;');
                percentText.parent(overlay);

                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://sebain.pythonanywhere.com/upload_catbox', true);

                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        const percent = Math.round((event.loaded / event.total) * 100);
                        progressBar.value(percent);
                        percentText.html(percent + '%');
                    }
                };

                xhr.onload = function() {
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Catbox –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å
                    const response = JSON.parse(xhr.responseText);
                    console.log('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:', response.url);
                    percentText.html('–ì–æ—Ç–æ–≤–æ!');
                    setTimeout(() => overlay.remove(), 1000);
                    input.value("")
                    history.push({
                        type: 'file',
                        value: response.url,
                        sender: pp,
                        time: Math.floor(Date.now() / 1000),
                        uid: getRandomFromRange(111111, 999999),
                        header: zagolov
                    });
                    push()
                };

                xhr.onerror = function() {
                    percentText.html('–û—à–∏–±–∫–∞!');
                    setTimeout(() => overlay.remove(), 1500);
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                };

                xhr.send(formData);
            }

            //–û—Ç–ø—Ä–∞–≤–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π - —Ñ—É–Ω—Ü–∏—è
            function vlog() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '*/*';

                input.onchange = () => {
                    const file = input.files[0];
                    if (!file) return;

                    const mimeType = file.type;
                    let fileType;
                    const fsize = (file.size / (1024 * 1024)).toFixed(2); // –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö
                    if (mimeType.startsWith('image/')) {
                        fileType = 'img';
                        if (fsize < 30) {
                            imgsent(file)
                        } else {
                            alerterr("–ë–æ–ª—å—à–æ–π –≤–µ—Å, –Ω–µ –±–æ–ª–µ–µ 30 –º–±")
                        }

                    } else if (mimeType.startsWith('video/')) {
                        fileType = 'vid';
                        if (fsize < 200) {
                            filesent(file, "–í–∏–¥–µ–æ")
                        } else {
                            alerterr("–ë–æ–ª—å—à–æ–π –≤–µ—Å, –Ω–µ –±–æ–ª–µ–µ 200 –º–±")
                        }
                    } else {
                        fileType = 'oth';
                        if (fsize < 200) {
                            filesent(file, "–ù–µ –æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ñ–∞–π–ª")
                        } else {
                            alerterr("–ë–æ–ª—å—à–æ–π –≤–µ—Å, –Ω–µ –±–æ–ª–µ–µ 200 –º–±")
                        }
                    }
                    console.log(fileType)
                };
                input.click();
            }

            function push() {
                xpush(pxsentpush)
            }

            function pxsentpush() {
                console.log("–ö–æ–ª-–±–µ–∫ –æ—Ç xpush –∏ push –ø—Ä–∏–Ω—è—Ç(—É—Å–ø–µ—à–Ω–æ)")
            }


            function xpush(callback) {
                if (lastmsg == history[history.length - 1].value) {
                    history.splice(history.length - 1, 1);
                } else {
                    lastmsg = history[history.length - 1].value;
                    msgs++;
                    SoundEffect("push.mp3");
                    historyP = history[history.length - 1];
                    let pushing = JSON.stringify(historyP);
                    console.log(pushing);
                    fetch("https://sebain.pythonanywhere.com/push?filename=chat_" + getCookie("chatid") + "&text=" + Crypt(pushing) + andpass)
                        .then(response => response.text())
                        .then(data => {
                            console.log("–ó–∞–≥—Ä—É–∑–∫–∞ " + data);
                            render();
                            callback()
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        });
                }
            }

            function pushAll() {
                msgs++;
                SoundEffect("push.mp3");

                let pushing = JSON.stringify(history);
                let payload = {
                    filename: "chat_" + getCookie("chatid"),
                    text: pushing
                };

                fetch("https://sebain.pythonanywhere.com/set_post", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(payload)
                    })
                    .then(response => response.text())
                    .then(data => {
                        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ " + data);
                        render();
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                    });
            }


            syssent = function(message) {
                input.value("")
                history.push({
                    type: 'text',
                    value: message,
                    sender: "system",
                    time: Math.floor(Date.now() / 1000),
                    uid: getRandomFromRange(111111, 999999)
                });
                push()
            };

            noCanvas(); // –æ—Ç–∫–ª—é—á–∞–µ–º —Ö–æ–ª—Å—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω
            function filterTextWithBanwords(inputText) {
                if (banwords.size === 0) {
                    console.warn('–°–ø–∏—Å–æ–∫ banwords –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return inputText;
                }

                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞, –ø—Ä–æ–±–µ–ª—ã –∏ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
                const tokens = inputText.match(/[\w–∞-—è–ê-–Ø—ë–Å]+|[^\w\s]|[\s]+/g);

                const filtered = tokens.map(token => {
                    const normalized = token.toLowerCase().replace(/[^–∞-—èa-z0-9]/gi, '');
                    return banwords.has(normalized) ? '(–º–∞—Ç)' : token;
                });

                return filtered.join('');
            }


            function updatebanlist() {
                fetch("https://sebain.pythonanywhere.com/get?filename=" + chatid + "_ignore")
                    .then(response => response.text())
                    .then(data => {
                        bans = JSON.parse(data)
                        if (ismuted(pp) || (target == "channel" && level == 1)) {
                            input.hide()
                            fileS.hide()
                            send.hide()
                            call.hide()
                        } else {
                            try {
                                input.show()
                                fileS.show()
                                send.show()
                                call.show()
                            } catch {
                                console.log("–°–≤—è–∑—å —á–∏–Ω–∏—Ç—å –Ω–µ –Ω–∞–¥–æ!")
                            }

                        }
                        if (isbanned(pp)) {
                            banrem(false)
                        }
                    })
                    .catch(error => {
                        if (target == "channel" && level == 1) {
                            input.hide()
                            fileS.hide()
                            send.hide()
                            call.hide()
                        } else {
                            try {
                                input.show()
                                fileS.show()
                                send.show()
                                call.show()
                            } catch {
                                console.log("–°–≤—è–∑—å —á–∏–Ω–∏—Ç—å –Ω–µ –Ω–∞–¥–æ!")
                            }

                        }
                    });
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º banwords.txt –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            fetch('/banword.txt')
                .then(res => res.text())
                .then(text => {
                    text
                        .split(/\r?\n/)
                        .map(w => w.trim().toLowerCase())
                        .forEach(w => {
                            if (w.length > 0) banwords.add(w);
                        });
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${banwords.size} –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤`);
                    update()
                    updatebanlist()

                });

            function reloadOnline() {
                if (level == 0) {
                    fetch("https://sebain.pythonanywhere.com/saveget?filename=" + getCookie("target") + "_last-online&text=" + Math.floor(Date.now() / 1000))
                        .then(response => response.text())
                        .then(data => {
                            let dif1 = Math.floor(Date.now() / 1000) - data
                            let dstate
                            if (dif1 < 60) {
                                dstate = "–í —Å–µ—Ç–∏";
                            } else if (dif1 < 60 * 2) {
                                dstate = "–í —Å–µ—Ç–∏ –º–∏–Ω—É—Ç—É –Ω–∞–∑–∞–¥";
                            } else if (dif1 < 60 * 60) {
                                dstate = "–í —Å–µ—Ç–∏ " + Math.floor(dif1 / 60) + " –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥";
                            } else if (dif1 < 60 * 60 * 24) {
                                dstate = "–í —Å–µ—Ç–∏ " + Math.floor(dif1 / 60 / 60) + " —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥";
                            } else {
                                dstate = "–í —Å–µ—Ç–∏ " + Math.floor(dif1 / 60 / 60 / 24) + " –¥–Ω–µ–π –Ω–∞–∑–∞–¥";
                            }
                            name.html(getCookie("name") + " (" + dstate + ")")
                        })
                        .catch(error => {
                            name.html(getCookie("name"))
                        });
                } else {
                    name.html(getCookie("name"))
                }

            }
            let found = 0
            setInterval(() => {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_last-online&text=" + Math.floor(Date.now() / 1000))
                    .then(response => response.text())
                    .then(data => {

                    })
                    .catch(error => {

                    });
                updatebanlist()
                reloadOnline()
                reloadStatus()
                console.log("–ö–∞–∂–¥—ã–µ 7 —Å–µ–∫—É–Ω–¥: –ø–∏–ø!");
                update()
                let num = history.length - 1
                if (found == 0) {
                    while (num > -1) {
                        if (history[num].sender == pp) {
                            num = -1000
                            found = 1
                        }
                        num--
                    }
                    if (found == 0) {
                        let placeholder = [{
                            type: 'invis',
                            value: "placeholder for notifications",
                            sender: pp,
                            time: Math.floor(Date.now() / 1000)
                        }];
                        let backpush = JSON.stringify(placeholder)
                        fetch("https://sebain.pythonanywhere.com/backpush?filename=chat_" + getCookie("chatid") + "&text=" + backpush)
                            .then(response => response.text())
                            .then(data => {
                                update()
                            })
                            .catch(error => {
                                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                            });
                    }
                }
            }, 7000)
            container = createDiv();
            container.id('myContainer')
                //container.id("chat-container"); // –¥–∞–¥–∏–º ID –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            container.style('display', 'flex');
            container.style('flex-direction', 'column');
            container.style('gap', '10px');
            container.style('padding', '20px');
            container.style('overflow', 'auto');
            container.size(window.innerWidth - 45, window.innerHeight - 100)
            container.position(0, 57)
            let exit = createButton("–í—ã—Ö–æ–¥")
            ButtonStyling(exit)
            exit.style('border-radius', '10px')
            exit.mousePressed(() => {
                window.location.href = "homepage.html"

            });
            exit.position(0, 0)
            exit.size(60, 37)
            let name = createP(getCookie("name"))
            name.style('border-radius', '10px')
            ButtonStyling(name)
            name.style('background', "rgba(" + hexToRGBValues(getCookie("colour")) + ", 0.36)");
            name.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues(getCookie("colour")) + " , 0.30)");

            name.mouseOver(() => {
                name.style('background', "rgba(" + hexToRGBValues(getCookie("colour")) + ", 0.50)");
                name.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues(getCookie("colour")) + " , 0.50)");
            });

            name.mouseOut(() => {
                name.style('background', "rgba(" + hexToRGBValues(getCookie("colour")) + ", 0.36)");
                name.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues(getCookie("colour")) + " , 0.30)");
            });
            //name.style('background-color', );
            name.position(60, -15)
            name.size(window.innerWidth - 142, 35)
            reloadOnline()
            let ban = createButton("–£–¥–∞–ª–∏—Ç—å!")

            function banrem(state) {
                fetch("https://sebain.pythonanywhere.com/savestget?filename=" + ps + "_chats")
                    .then(response => response.text())
                    .then(data => {
                        let list = JSON.parse(data);
                        const cookieChatId = getCookie('chatid');
                        const cookieIdStr = cookieChatId != null ? String(cookieChatId).trim() : '';

                        newList = list.filter(function(o) {
                            const chatId = (o && o.chatid != null) ? String(o.chatid).trim() : '';
                            return chatId !== cookieIdStr;
                        });

                        const exportJson = JSON.stringify(newList);



                        return fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_chats" + "&text=" + exportJson);
                    })
                    .then(response => response.text())
                    .then(() => {
                        if (state) {
                            history.push({
                                type: 'text',
                                value: pp + " –£–¥–∞–ª–∏–ª —ç—Ç—É –ø–µ—Ä–µ–ø–∏—Å–∫—É",
                                sender: "system",
                                time: Math.floor(Date.now() / 1000)
                            });

                            SoundEffect("push.mp3");

                            let pushing = JSON.stringify(history);
                            let payload = {
                                filename: "chat_" + getCookie("chatid"),
                                text: pushing
                            };

                            fetch("https://sebain.pythonanywhere.com/set_post", {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json"
                                    },
                                    body: JSON.stringify(payload)
                                })
                                .then(response => response.text())
                                .then(data => {
                                    console.log("–ó–∞–≥—Ä—É–∑–∫–∞" + data);
                                    render();
                                    fetch("https://sebain.pythonanywhere.com/unreg?filename=chat_" + getCookie("chatid") + "&key=" + ps)
                                        .then(response => response.text())
                                        .then(data => {
                                            render()
                                            alert("–£–¥–∞–ª–µ–Ω–æ!");
                                            window.location.href = "homepage.html";
                                        })
                                        .catch(error => {
                                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                                        });

                                })
                                .catch(error => {
                                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                                });
                        } else {
                            window.location.href = "homepage.html";
                        }

                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:", error);
                    });
            }
            ban.mousePressed(() => {
                let confirm = prompt(
                    "–ï—Å–ª–∏ –≤—ã –∏ –≤–ø—Ä–∞–≤–¥—É —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —á–∞—Ç : " + getCookie("name") +
                    ", —Ç–æ –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏ —ç—Ç–æ —á–∏—Å–ª–æ: " + getCookie("chatid") + " –∏ –Ω–∞–∂–º–∏ –æ–∫"
                );

                if (confirm === getCookie("chatid")) {
                    banrem(true)
                }
            })
            ButtonStyling(ban)
            ban.style('border-radius', '10px')
            ban.position(window.innerWidth - 80, 0)
            ban.size(77, 37)
            let call = createButton("–°–æ–∑–≤–æ–Ω")
            ButtonStyling(call)
            call.style('border-radius', '7px')
            call.position(window.innerWidth - 80, 38)
            call.size(77, 20)
            call.mousePressed(() => {
                if (history[history.length - 1].type != "call") {
                    joiningcall = getRandomFromRange(11111, 99999)
                    history.push({
                        type: 'call',
                        value: "–°–æ–∑–≤–æ–Ω –Ω–∞—á–∞—Ç [–ó–ê–ô–¢–ò]",
                        sender: pp,
                        time: Math.floor(Date.now() / 1000),
                        uid: getRandomFromRange(1111111111, 9999999999),
                        callid: joiningcall
                    });
                    xpush(joincall)
                } else {
                    alert("–£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Å–æ–∑–≤–æ–Ω, –∑–∞–π–¥–∏—Ç–µ –≤ –Ω–µ–≥–æ!")
                }
            });

            function joincall() {
                setCookie2("callid", joiningcall)
                window.location.href = "call.html"
            }

            function biggerINPUT() {
                if (inputBIG && input.value().length < 16) {
                    inputBIG = false
                    let oldtext = input.value()
                    input.remove();
                    input = createInput(oldtext)
                    ButtonStyling(input)
                    input.attribute('placeholder', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...');
                    input.style('font-size', '16px');

                    input.style('background', "rgba(" + hexToRGBValues("#000000") + ", 0.66)");
                    input.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#000000") + " , 0.60)");
                    input.mouseOver(() => {});
                    input.mouseOut(() => {});
                    input.style('border-radius', '8px')
                    input.input(biggerINPUT)
                    input.elt.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            console.log('Enter –Ω–∞–∂–∞—Ç: ' + input.value());
                            sent(input.value())

                        }
                    });
                    input.elt.focus()
                    input.elt.setSelectionRange(15, 15)
                    inputposititoner()
                } else if (!inputBIG && input.value().length > 15) {
                    let currentText = input.value();

                    input.remove();

                    input = createElement('textarea', currentText);
                    ButtonStyling(input)
                    input.attribute('placeholder', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...');
                    input.style('font-size', '12px');

                    input.style('background', "rgba(" + hexToRGBValues("#000000") + ", 0.66)");
                    input.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#000000") + " , 0.60)");
                    input.mouseOver(() => {});
                    input.mouseOut(() => {});
                    input.style('border-radius', '8px')
                    inputBIG = true
                    input.input(biggerINPUT)
                    input.elt.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            console.log('Enter –Ω–∞–∂–∞—Ç: ' + input.value());
                            sent(input.value())

                        }
                    });
                    input.elt.focus()
                    input.elt.setSelectionRange(16, 16)
                    inputposititoner()
                }
            }

            function inputposititoner() {
                send.position(window.innerWidth - 65, window.innerHeight - 40)
                sendP.position(window.innerWidth - 61, window.innerHeight - 70)
                fileS.position(window.innerWidth - 105, window.innerHeight - 40)
                fileSP.position(window.innerWidth - 101, window.innerHeight - 63)
                if (inputBIG) {
                    input.position(15, window.innerHeight - 120)
                    input.size(window.innerWidth - 45, 75)
                } else {
                    input.position(15, window.innerHeight - 40)
                    input.size(window.innerWidth - 45, 30)
                }
            }
            //–ù–∞—á–∞–ª–æ –Ω–∞–¥ –ø–æ–ª–µ–≤–≤–æ–¥–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∏ –∏–Ω–ø—É—Ç
            window.addEventListener("resize", () => {
                inputposititoner()
                BackStyling()
            });
            var input = createInput()
            ButtonStyling(input)
            input.attribute('placeholder', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...');
            input.style('font-size', '16px');
            input.style('background', "rgba(" + hexToRGBValues("#000000") + ", 0.66)");
            input.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#000000") + " , 0.60)");
            input.mouseOver(() => {});
            input.mouseOut(() => {});
            input.style('border-radius', '8px')
            input.input(biggerINPUT)
            input.elt.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    console.log('Enter –Ω–∞–∂–∞—Ç: ' + input.value());
                    sent(input.value())

                }
            });

            //–ö–æ–Ω–µ—Ü –∏–Ω–ø—É—Ç–∞
            let send = createButton("")
            ButtonStyling(send)

            send.size(40, 34)
            send.style('border-radius', '8px')
            send.style('position', 'fixed');
            send.style('z-index', '1');
            let sendP = createP("üì®")

            sendP.size(40, 34)
            sendP.style('pointer-events', 'none')
            sendP.style('font-size', '24px')
            sendP.style('position', 'fixed');
            sendP.style('z-index', '2');
            let fileS = createButton("")
            ButtonStyling(fileS)

            fileS.size(40, 34)
            fileS.style('border-radius', '8px')
            fileS.mousePressed(() => {
                vlog()
            });
            fileS.style('position', 'fixed');
            fileS.style('z-index', '1');
            let fileSP = createP("üìé")

            fileSP.size(40, 34)
            fileSP.style('pointer-events', 'none')
            fileSP.style('font-size', '24px')
            fileSP.style('position', 'fixed');
            fileSP.style('z-index', '2');
            inputposititoner()
                //–ö–æ–Ω–µ—Ü –Ω–∞–¥ –ø–æ–ª–µ–≤–≤–æ–¥–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            function getTextLength(text) {
                return text.length;
            }

            function sent(message) {
                let cant = false
                if (getCookie("nofilt") == 1) {
                    console.log("–§–∏–ª—å—Ç—Ä –≤—ã–∫–ª—é—á–µ–Ω")
                } else {
                    if (filterTextWithBanwords(message) == message) {
                        console.log("–§–∏–ª—å—Ç—Ä –≤–∫–ª—é—á–µ–Ω –Ω–æ –º–∞—Ç–æ–≤ –Ω–µ—Ç")
                    } else {
                        cant = true
                    }
                }
                //console.log(getTextLength(message))
                if (getTextLength(message) > 350) {
                    alert("–î–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
                } else if (getTextLength(message) < 2) {
                    alert("–ö–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!")
                } else if (cant) {
                    alert("–ù–µ–ª—å–∑—è –º–∞—Ç–µ—Ä–∏—Ç—Å—è —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –º–∞—Ç–æ–≤!")
                } else {
                    if (message != "") {
                        input.value("")
                        history.push({
                            type: 'text',
                            value: message,
                            sender: pp,
                            time: Math.floor(Date.now() / 1000),
                            uid: getRandomFromRange(111111, 999999)
                        });
                        push()
                    }
                }
            }


            send.mousePressed(() => {
                sent(input.value())
                input.value("")
                biggerINPUT()
            });
        }
    </script>
    <!-- start webpushr code -->
    <script>
        function _webpushrScriptReady() {
            console.log(getCookie("ss"))
            webpushr('attributes', {
                "key1": "value",
                'user_id': getCookie("ss")
            });
        }
        (function(w, d, s, id) {
            if (typeof(w.webpushr) !== 'undefined') return;
            w.webpushr = w.webpushr || function() {
                (w.webpushr.q = w.webpushr.q || []).push(arguments)
            };
            var js, fjs = d.getElementsByTagName(s)[0];
            js = d.createElement(s);
            js.id = id;
            js.async = 1;
            js.src = "https://cdn.webpushr.com/app.min.js";
            fjs.parentNode.appendChild(js);
        }(window, document, 'script', 'webpushr-jssdk'));
        webpushr('setup', {
            'key': 'BFLe_7o4MjpBAJQqK9Zue9crqf0lRfNO6uipfd0w9HRPbZzy0QBIxTXezp_XTPdpXV_dvyDr6GjhTVZpvYlxiUc',
            'user_id': getCookie("ss")
        });
    </script>
    <!-- end webpushr code -->
</body>

</html>