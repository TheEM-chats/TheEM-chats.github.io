<!DOCTYPE html>
<html lang="ru">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <meta charset="UTF-8" />
    <title>TheEM - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É p5.js –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ p5.dom -->

    <script src="libs/p5.js"></script>
    <script src="libs/xlibs.js"></script>
</head>

<body>
    <script>
        let myButton;
        let ss = getCookie("ss")
        let pp = getCookie("pp");
        let ps = getCookie("ps")
        let globalres = ""


        function setup() {

            window.addEventListener("resize", () => {
                console.log("–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è:");
                console.log("–ù–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞: " + window.innerWidth);
                console.log("–ù–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞: " + window.innerHeight);
            });

            function getProfUrl(pubk, element) {
                fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pubk + "_img")
                    .then(response => response.text())
                    .then(data => {
                        data = Decrypt(data)
                        console.log(data)
                        if (data == "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ save") {
                            element.style('background-image', 'url("https://i.ibb.co/F4qyF7RN/blank.png")')
                        } else {
                            element.style('background-image', `url("${data}")`);

                        }
                    })
                    .catch(error => {
                        element.style('background-image', 'url("https://i.ibb.co/F4qyF7RN/blank.png")')
                    });
            }

            function getProf(url) {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_img&text=" + Crypt(url))
                    .then(response => response.text())
                    .then(data => {
                        alert("–ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
                        window.location.href = "setts.html"
                    })
                    .catch(error => {

                    });
            }

            function uploadProf() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = 512;
                            canvas.height = 512;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, 512, 512);

                            canvas.toBlob((blob) => {
                                if (blob.size > 10 * 1024 * 1024) {
                                    alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è (>10MB)");
                                    return;
                                }

                                const formData = new FormData();
                                formData.append("image", blob);

                                // üîê –í—Å—Ç–∞–≤—å —Å–≤–æ–π API –∫–ª—é—á imgbb –Ω–∏–∂–µ
                                const apiKey = "c77c07592cd1f730aacfb02824de3a17";
                                const uploadUrl = "https://api.imgbb.com/1/upload?key=" + apiKey;

                                fetch(uploadUrl, {
                                        method: "POST",
                                        body: formData
                                    })
                                    .then(res => res.json())
                                    .then(data => {
                                        if (data.success) {
                                            const imageUrl = data.data.url;
                                            getProf(imageUrl); // üöÄ –í—ã–∑–æ–≤ —Ç–≤–æ–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Å—Å—ã–ª–∫–æ–π
                                        } else {
                                            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", data);
                                            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
                                        }
                                    })
                                    .catch(err => {
                                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", err);
                                        alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è");
                                    });

                            }, 'image/jpeg', 0.9);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                };

                input.click(); // üîî –ó–∞–ø—É—Å–∫–∞–µ–º –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
            }

            if (getCookie("captcha") == "yes") {
                alert("–ü—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É")
                window.location.href = "captcha.html"
            }
            if (getCookie("IsReg") != "1") {
                window.location.href = "index.html";
            }

            noCanvas(); // –æ—Ç–∫–ª—é—á–∞–µ–º —Ö–æ–ª—Å—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω
            let btn = createButton('');
            getProfUrl(pp, btn)
            btn.style('background-size', 'cover');
            btn.mousePressed(() => {
                uploadProf()
            });
            btn.size(32, 32)
            let ext = createButton('–í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é');
            ext.position(0, window.innerHeight - 50);
            ext.size(window.innerWidth, 25);

            ext.mousePressed(() => {
                window.location.href = "homepage.html";
            });
            let bwstate
            if (getCookie("nofilt") == 1) {
                bwstate = "(–æ—Ç–∫–ª—é—á–µ–Ω)"
            } else {
                bwstate = "(–≤–∫–ª—é—á–µ–Ω)"
            }
            mail = createButton("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ " + bwstate);
            mail.position(0, 150)
            mail.size(window.innerWidth, 25)
            mail.mousePressed(() => {
                if (getCookie("nofilt") == 1) {
                    setCookie2("nofilt", "vkly")
                    alert("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ –≤–∫–ª—é—á–µ–Ω!")
                    window.location.href = "setts.html";
                } else {
                    let f = getRandomFromRange(10, 100)
                    let s = getRandomFromRange(10, 100)
                    let ans = prompt("–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å:" + f + "+" + s)
                    if (ans == f + s) {
                        setCookie2("nofilt", "1")
                        alert("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω!")
                        window.location.href = "setts.html";
                    } else {
                        alert("–ü—Ä–∏–º–µ—Ä —Ä–µ—à—ë–Ω –Ω–µ –≤–µ—Ä–Ω–æ!")
                    }
                }
            });
            //–ù–∏–∫
            let mynik
            console.log(getRandomBrightColor())
            let colour = createButton("–°–º–µ–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –Ω–∏–∫–∞");
            colour.position(0, 100)
            colour.size(window.innerWidth, 25)
            fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pp + "_colour")
                .then(response => response.text())
                .then(data => {
                    let data5 = data
                    console.log(data)
                    if (data == "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ save") {
                        crush
                    }

                    fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pp + "_profn")
                        .then(response => response.text())
                        .then(data => {
                            mynik = createP(data)
                            mynik.style('background-color', "#" + data5);
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                            alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∏–∫–∞! –í–∏–¥–Ω–æ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!!!")
                        });


                })
                .catch(error => {
                    fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_colour&text=" + getRandomBrightColor())
                        .then(response => response.text())
                        .then(data => {
                            globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                            console.log(globalres);
                            window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                            alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç!!! –û–Ω –≤–æ–∑–º–æ–∂–Ω–æ –ª–∞–º–∞—Ç—ã–π —É –≤–∞—Å!")
                        });
                });
            colour.mousePressed(() => {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_colour&text=" + getRandomBrightColor())
                    .then(response => response.text())
                    .then(data => {
                        globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                        console.log(globalres);
                        window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç!!! –û–Ω –≤–æ–∑–º–æ–∂–Ω–æ –ª–∞–º–∞—Ç—ã–π —É –≤–∞—Å!")
                    });
            });
            let changebutton = createButton("–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫");
            changebutton.position(0, 125)
            changebutton.size(window.innerWidth, 25)
            changebutton.mousePressed(() => {
                let newnik = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è/–Ω–∏–∫/–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–æ–≤–∫–∏, —Ü–∏—Ñ–µ—Ä–∫–∏, @ –∏ . )(–î—Ä—É–≥–∏–µ —Å–∏–º–æ–ª—ã –Ω–µ–ª—å–∑—è)")
                if (newnik == "" || newnik == null) {
                    alert("–ù–∏–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!!")
                } else {
                    fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_profn&text=" + newnik)
                        .then(response => response.text())
                        .then(data => {
                            globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                            console.log(globalres);
                            window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        });
                }
            });
        }
    </script>
</body>

</html>