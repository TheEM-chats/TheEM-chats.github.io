<!DOCTYPE html>
<html lang="ru">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    html,
    body {
        overflow: hidden;
        margin: 0;
        padding: 0;
    }
</style>

<head>
    <meta charset="UTF-8" />
    <title>TheEM - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É p5.js –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ p5.dom -->

    <script src="libs/p5.js"></script>
    <script src="libs/xlibs.js"></script>
</head>

<body>
    <script>
        let myButton;
        let ss = getCookie("ss")
        let pp = getCookie("pp");
        let ps = getCookie("ps")
        let globalres = ""

        var f
        var s

        function reloader() {
            window.location.href = "setts.html"
        }

        function setup() {
            BackStyling()
            window.addEventListener("resize", () => {
                console.log("–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è:");
                console.log("–ù–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞: " + window.innerWidth);
                console.log("–ù–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞: " + window.innerHeight);
            });

            function getProfUrl(pubk, element) {
                fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pubk + "_img")
                    .then(response => response.text())
                    .then(data => {
                        data = Decrypt(data)
                        console.log(data)
                        if (data == "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ save") {
                            element.style('background-image', 'url("https://i.ibb.co/F4qyF7RN/blank.png")')
                            element.mouseOver(() => {});
                            element.mouseOut(() => {});
                        } else {
                            element.style('background-image', `url("${data}")`);
                            element.mouseOver(() => {});
                            element.mouseOut(() => {});

                        }
                    })
                    .catch(error => {
                        element.style('background-image', 'url("https://i.ibb.co/F4qyF7RN/blank.png")')
                        element.mouseOver(() => {});
                        element.mouseOut(() => {});
                    });
            }

            function getProf(url) {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_img&text=" + Crypt(url))
                    .then(response => response.text())
                    .then(data => {
                        xAlert("–ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞", reloader)
                    })
                    .catch(error => {

                    });
            }

            function uploadProf() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = 512;
                            canvas.height = 512;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, 512, 512);

                            canvas.toBlob((blob) => {
                                if (blob.size > 10 * 1024 * 1024) {
                                    xAlert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è (>10MB)");
                                    return;
                                }

                                const formData = new FormData();
                                formData.append("image", blob);

                                // üîê –í—Å—Ç–∞–≤—å —Å–≤–æ–π API –∫–ª—é—á imgbb –Ω–∏–∂–µ
                                const apiKey = "c77c07592cd1f730aacfb02824de3a17";
                                const uploadUrl = "https://api.imgbb.com/1/upload?key=" + apiKey;

                                fetch(uploadUrl, {
                                        method: "POST",
                                        body: formData
                                    })
                                    .then(res => res.json())
                                    .then(data => {
                                        if (data.success) {
                                            const imageUrl = data.data.url;
                                            getProf(imageUrl); // üöÄ –í—ã–∑–æ–≤ —Ç–≤–æ–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Å—Å—ã–ª–∫–æ–π
                                        } else {
                                            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", data);
                                            xAlert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
                                        }
                                    })
                                    .catch(err => {
                                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", err);
                                        xAlert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è");
                                    });

                            }, 'image/jpeg', 0.9);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                };

                input.click(); // üîî –ó–∞–ø—É—Å–∫–∞–µ–º –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
            }

            if (getCookie("captcha") == "yes") {
                alert("–ü—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É")
                window.location.href = "captcha.html"
            }
            if (getCookie("IsReg") != "1") {
                window.location.href = "index.html";
            }

            noCanvas(); // –æ—Ç–∫–ª—é—á–∞–µ–º —Ö–æ–ª—Å—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω
            let btn = createButton('');
            ButtonStyling(btn)
            getProfUrl(pp, btn)
            btn.mouseOver(() => {});
            btn.mouseOut(() => {});
            btn.style('background-size', 'cover');
            btn.mousePressed(() => {
                uploadProf()
            });
            btn.size(64, 64)
            btn.position(10, 10)
            let bwstate
            if (getCookie("nofilt") == 1) {
                bwstate = "(–æ—Ç–∫–ª—é—á–µ–Ω)"
            } else {
                bwstate = "(–≤–∫–ª—é—á–µ–Ω)"
            }
            mail = createButton("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ " + bwstate);
            mail.position(0, 200)
            mail.size(window.innerWidth, 38)
            ButtonStyling(mail)

            function PSolver(ans) {
                if (ans == f + s) {
                    setCookie2("nofilt", "1")
                    xAlert("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ –≤—ã–∫–ª—é—á–µ–Ω", reloader)
                } else {
                    xAlert("–ü—Ä–∏–º–µ—Ä —Ä–µ—à—ë–Ω –Ω–µ –≤–µ—Ä–Ω–æ!")
                }
            }
            mail.mousePressed(() => {
                if (getCookie("nofilt") == 1) {
                    setCookie2("nofilt", "vkly")
                    xAlert("–§–∏–ª—å—Ç—Ä –º–∞—Ç–æ–≤ –≤–∫–ª—é—á–µ–Ω", reloader)
                } else {
                    f = getRandomFromRange(10, 100)
                    s = getRandomFromRange(10, 100)
                    xPrompt("–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å:" + f + "+" + s, PSolver)
                }
            });
            //–ù–∏–∫
            let mynik
            console.log(getRandomBrightColor())
            let colour = createButton("–°–º–µ–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –Ω–∏–∫–∞");
            colour.position(0, 100)
            colour.size(window.innerWidth, 38)
            ButtonStyling(colour)
            fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pp + "_colour")
                .then(response => response.text())
                .then(data => {
                    let data5 = data
                    console.log(data)
                    if (data == "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ save") {
                        crush
                    }

                    fetch("https://sebain.pythonanywhere.com/saveget?filename=" + pp + "_profn")
                        .then(response => response.text())
                        .then(data => {
                            mynik = createP(data)
                            mynik.style('font-size', '24px');
                            ButtonStyling(mynik)
                            mynik.position(80, 5)
                            mynik.style('background', "rgba(" + hexToRGBValues("#" + data5) + ", 0.36)");
                            mynik.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#" + data5) + " , 0.30)");

                            mynik.mouseOver(() => {
                                mynik.style('background', "rgba(" + hexToRGBValues("#" + data5) + ", 0.50)");
                                mynik.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#" + data5) + " , 0.50)");
                            });

                            mynik.mouseOut(() => {
                                mynik.style('background', "rgba(" + hexToRGBValues("#" + data5) + ", 0.36)");
                                mynik.style('box-shadow', "0 2px 6px rgba(" + hexToRGBValues("#" + data5) + " , 0.30)");
                            });
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                            xAlert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∏–∫–∞!", reloader)
                        });


                })
                .catch(error => {
                    fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_colour&text=" + getRandomBrightColor())
                        .then(response => response.text())
                        .then(data => {
                            globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                            console.log(globalres);
                            window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        })
                        .catch(error => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                            xAlert("–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º!", reloader)
                        });
                });
            colour.mousePressed(() => {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_colour&text=" + getRandomBrightColor())
                    .then(response => response.text())
                    .then(data => {
                        globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                        console.log(globalres);
                        window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                        xAlert("–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º", reloader)
                    });
            });
            let changebutton = createButton("–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫");
            changebutton.position(0, 150)
            changebutton.size(window.innerWidth, 38)
            ButtonStyling(changebutton)

            function nikchange(newnik) {
                fetch("https://sebain.pythonanywhere.com/saveset?filename=" + ps + "_profn&text=" + newnik)
                    .then(response => response.text())
                    .then(data => {
                        globalres = data; // –≤—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                        console.log(globalres);
                        window.location.href = "setts.html"; // –≤—ã–≤–æ–¥–∏–º —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                    });
            }
            changebutton.mousePressed(() => {
                xPrompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è/–Ω–∏–∫/–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–æ–≤–∫–∏, —Ü–∏—Ñ–µ—Ä–∫–∏, @ –∏ . )(–î—Ä—É–≥–∏–µ —Å–∏–º–æ–ª—ã –Ω–µ–ª—å–∑—è)", nikchange)
            });
            let updates = createButton("–°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π");
            updates.position(0, 250)
            updates.size(window.innerWidth, 38)
            ButtonStyling(updates)
            updates.mousePressed(() => {
                window.location.href = "update.html"
            });

            let grouper = createButton("–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª");
            grouper.position(0, 300)
            grouper.size(window.innerWidth, 38)
            ButtonStyling(grouper)
            grouper.mousePressed(() => {
                window.location.href = "grouper.html"
            });
        }
    </script>
</body>

</html>